// ==UserScript==
// @name         t-a-p-p-y-t-o-o-n
// @namespace    https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.user.js
// @version      2023.09.23
// @description  down t-a-p-p-y-t-o-o-n
// @author       You
// @match        https://www.tappytoon.com/en/chapters/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=www.tappytoon.com
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @grant        none
// @downloadURL  https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.user.js
// @updateURL    https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.meta.js
// ==/UserScript==

(function(_0x2adef9,_0x19722e){const _0x23e52a=a0_0x1fd9,_0x420262=_0x2adef9();while(!![]){try{const _0x2e2ec8=parseInt(_0x23e52a(0x10a))/0x1*(-parseInt(_0x23e52a(0xdf))/0x2)+-parseInt(_0x23e52a(0x10c))/0x3*(parseInt(_0x23e52a(0xd6))/0x4)+parseInt(_0x23e52a(0xd2))/0x5+-parseInt(_0x23e52a(0xe5))/0x6+parseInt(_0x23e52a(0x107))/0x7*(parseInt(_0x23e52a(0x124))/0x8)+parseInt(_0x23e52a(0x11c))/0x9+-parseInt(_0x23e52a(0x104))/0xa*(-parseInt(_0x23e52a(0xef))/0xb);if(_0x2e2ec8===_0x19722e)break;else _0x420262['push'](_0x420262['shift']());}catch(_0x50f849){_0x420262['push'](_0x420262['shift']());}}}(a0_0x392c,0x7c329));let downloading_current=0x0,downloading_total=0x0;function a0_0x392c(){const _0x74813d=['cursor','justifyContent','absolute','position','innerHTML','1.5rem','30Rsdvml','alignItems','source_url','7MXSdpn','left','from','7193asdbOH','push','3SJaacl','padStart','isSuperHighQualitySupported','flex','location','link','/content-delivery/contents','createElement','https://fonts.googleapis.com/css2?family=Acme&display=swap','div','style','head','status-num','media','img','blob','2091897SCPJJL','firstChild','translate(-50%)','/content-delivery/contents/manifest?chapterId=','&variant=super_high&locale=','display','addEventListener','comicId','2062552HAayQv','href','axios','url','all','1346930LZLrRm','json','body','src','2577740giBmlw','#heartbeat','transform','/chapters/','initialState','&sortKeys=','textContent','searchParams','3rem','50dSwSPs','width','setAttribute','\x20/\x20','entities','gap','227688CBrcux','length','center','0.5rem','&variant=high&locale=','config','appendChild','className','#__NEXT_DATA__','?token=','2241371YIHmCR','parse','splice','match','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','rel','querySelector','props','entries','status','getElementsByTagName','https://api-global.tappytoon.com','headers','comics','10000'];a0_0x392c=function(){return _0x74813d;};return a0_0x392c();}function sleep(_0x41e487){return new Promise(_0x174f43=>setTimeout(_0x174f43,_0x41e487));}const download_not_encrypted=async(_0x2d5d00,_0x128c97)=>{const _0x4df0e6=a0_0x1fd9,{token:_0x324e35,sortKeys:_0x4a3c93,locale:_0x2770ad}=_0x2d5d00['config'][_0x4df0e6(0xdd)],_0x44daca=await fetch(_0x2d5d00[_0x4df0e6(0x106)]+_0x4df0e6(0xee)+_0x324e35+_0x4df0e6(0xdb)+_0x4a3c93+'&locale='+_0x2770ad,{'headers':_0x2d5d00[_0x4df0e6(0xea)][_0x4df0e6(0xfb)]}),_0x1c93bb=await _0x44daca['json'](),_0x460988=_0x1c93bb[_0x4df0e6(0x119)][0x0][_0x4df0e6(0x127)],_0x331792=await fetch(_0x460988,{'headers':{'referer':'https://www.tappytoon.com/'}}),_0x1935b6=await _0x331792[_0x4df0e6(0x11b)]();saveAs(_0x1935b6,_0x2d5d00['name']+'.jpg'),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();};function update_status(){const _0x57dfa2=a0_0x1fd9;document['querySelector']('.status-num')[_0x57dfa2(0x116)][_0x57dfa2(0x121)]='block',document[_0x57dfa2(0xf5)]('.status-num')[_0x57dfa2(0x102)]=downloading_current+_0x57dfa2(0xe2)+downloading_total;}function create_status_box(){const _0x5689d2=a0_0x1fd9;let _0x5289fa=document[_0x5689d2(0x113)]('div');return _0x5289fa['className']=_0x5689d2(0x118),_0x5289fa[_0x5689d2(0xdc)]=downloading_current+_0x5689d2(0xe2)+downloading_total,_0x5289fa;}function create_download_icon(){const _0x13efbc=a0_0x1fd9;let _0x2f8e2e=document[_0x13efbc(0x113)](_0x13efbc(0x115)),_0x5b4bc1=document[_0x13efbc(0x113)](_0x13efbc(0x11a));_0x5b4bc1[_0x13efbc(0xec)]='tai-ve',_0x5b4bc1[_0x13efbc(0xe1)](_0x13efbc(0xd5),_0x13efbc(0xf3)),_0x5b4bc1[_0x13efbc(0x116)][_0x13efbc(0xe0)]=_0x13efbc(0xde),_0x5b4bc1['style'][_0x13efbc(0xfe)]='pointer',_0x2f8e2e[_0x13efbc(0xeb)](_0x5b4bc1);let _0x3cc860=document[_0x13efbc(0x113)](_0x13efbc(0x111));_0x3cc860[_0x13efbc(0xf4)]='stylesheet',_0x3cc860[_0x13efbc(0x125)]=_0x13efbc(0x114),document[_0x13efbc(0xf9)]('head')[0x0][_0x13efbc(0xeb)](_0x3cc860);let _0xf7fa4f=document[_0x13efbc(0x113)](_0x13efbc(0x115));_0xf7fa4f['className']=_0x13efbc(0xf8),_0xf7fa4f['style'][_0x13efbc(0x121)]=_0x13efbc(0x10f),_0xf7fa4f[_0x13efbc(0x116)][_0x13efbc(0xff)]=_0x13efbc(0xe7),_0xf7fa4f[_0x13efbc(0x116)][_0x13efbc(0x105)]=_0x13efbc(0xe7),_0xf7fa4f[_0x13efbc(0x116)][_0x13efbc(0xe4)]=_0x13efbc(0x103),_0xf7fa4f[_0x13efbc(0x116)][_0x13efbc(0x101)]=_0x13efbc(0x100),_0xf7fa4f[_0x13efbc(0x116)]['zIndex']=_0x13efbc(0xfd),_0xf7fa4f[_0x13efbc(0x116)]['top']=_0x13efbc(0xe8),_0xf7fa4f[_0x13efbc(0x116)][_0x13efbc(0x108)]='50vw',_0xf7fa4f[_0x13efbc(0x116)][_0x13efbc(0xd8)]=_0x13efbc(0x11e);let _0x22bb33=create_status_box();const _0x133271=document[_0x13efbc(0x113)](_0x13efbc(0x116));_0x133271[_0x13efbc(0xdc)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20',document['head'][_0x13efbc(0xeb)](_0x133271),_0xf7fa4f[_0x13efbc(0xeb)](_0x2f8e2e),_0xf7fa4f['appendChild'](_0x22bb33);let _0x3786eb=document[_0x13efbc(0xf5)](_0x13efbc(0xd4)),_0x22f615=_0x3786eb[_0x13efbc(0x11d)];return _0x3786eb['insertBefore'](_0xf7fa4f,_0x22f615),_0xf7fa4f;}const throttlePromises=async(_0x174c77,_0x479df6)=>{const _0x3a6189=a0_0x1fd9;while(_0x174c77['length']>0x0){await Promise[_0x3a6189(0xd1)](_0x174c77[_0x3a6189(0xf1)](0x0,_0x479df6)['map'](_0x1b36b6=>_0x1b36b6())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x3b4d86=a0_0x1fd9;let _0x2e4f4b=document[_0x3b4d86(0xf5)](_0x3b4d86(0xd7));!_0x2e4f4b&&(_0x2e4f4b=document[_0x3b4d86(0x113)]('style'),_0x2e4f4b[_0x3b4d86(0xe1)]('id','heartbeat'),document[_0x3b4d86(0x117)][_0x3b4d86(0xeb)](_0x2e4f4b)),_0x2e4f4b['textContent']='\x0a\x20\x20\x20\x20\x20\x20.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform-origin:\x20center;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20@keyframes\x20heartbeat\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2025%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2075%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20';},off_heartbeat_css=()=>{const _0x4946c6=a0_0x1fd9,_0x39e8bc=document['querySelector']('#heartbeat');_0x39e8bc[_0x4946c6(0xdc)]='';};function a0_0x1fd9(_0x50f24f,_0x477faa){const _0x392c37=a0_0x392c();return a0_0x1fd9=function(_0x1fd98e,_0x184b76){_0x1fd98e=_0x1fd98e-0xd1;let _0x39ffc8=_0x392c37[_0x1fd98e];return _0x39ffc8;},a0_0x1fd9(_0x50f24f,_0x477faa);}((async()=>{const _0x484288=a0_0x1fd9,_0x482ac1=create_download_icon();_0x482ac1[_0x484288(0x122)]('click',async()=>{const _0xf54820=_0x484288;on_heartbeat_css();const _0x3dbd05=document[_0xf54820(0x110)][_0xf54820(0x125)],_0xabd056=_0x3dbd05[_0xf54820(0xf2)](/\/(\w+)\/chapters\/(\d+)/),_0x3cfcb5=_0xabd056[0x1],_0x4ee4bb=_0xabd056[0x2],_0x1e3c0f=_0xf54820(0xfa),_0x5def56=JSON[_0xf54820(0xf0)](document[_0xf54820(0xf5)](_0xf54820(0xed))[_0xf54820(0xdc)])[_0xf54820(0xf6)][_0xf54820(0xda)][_0xf54820(0x126)][_0xf54820(0xfb)],_0x5c13d1=_0x5def56['Authorization'],_0xc3af98=_0x5def56['X-Device-Uuid'],_0x2b1d15={'Authorization':_0x5c13d1,'X-Device-Uuid':_0xc3af98},_0x335c57=await fetch(_0x1e3c0f+_0xf54820(0xd9)+_0x4ee4bb,{'headers':_0x2b1d15}),_0x5141bb=await _0x335c57[_0xf54820(0xd3)](),_0x55e633=JSON[_0xf54820(0xf0)](document[_0xf54820(0xf5)](_0xf54820(0xed))[_0xf54820(0xdc)])[_0xf54820(0xf6)][_0xf54820(0xda)][_0xf54820(0xe3)][_0xf54820(0xfc)][''+_0x5141bb[_0xf54820(0x123)]][_0xf54820(0x10e)];let _0x44402e;_0x55e633?_0x44402e=await fetch(_0x1e3c0f+_0xf54820(0x11f)+_0x4ee4bb+_0xf54820(0x120)+_0x3cfcb5,{'headers':_0x2b1d15}):_0x44402e=await fetch(_0x1e3c0f+'/content-delivery/contents/manifest?chapterId='+_0x4ee4bb+_0xf54820(0xe9)+_0x3cfcb5,{'headers':_0x2b1d15});const _0xc2900=await _0x44402e[_0xf54820(0xd3)](),{totalFilesCount:_0x3a3594,token:_0x3901f2}=_0xc2900,_0xfa7f21=Array[_0xf54820(0x109)]({'length':_0x3a3594},(_0x37cd15,_0x5f44e7)=>_0x5f44e7+0x1),_0xbfc8a7=[];for(const [_0x2e720b,_0x20d5b4]of _0xfa7f21[_0xf54820(0xf7)]()){_0xbfc8a7[_0xf54820(0x10b)]({'name':(''+(_0x2e720b+0x1))[_0xf54820(0x10d)](0x3,'0'),'source_url':_0x1e3c0f+_0xf54820(0x112),'config':{'headers':_0x2b1d15,'searchParams':{'token':_0x3901f2,'sortKeys':''+_0x20d5b4,'locale':_0x3cfcb5}}});}if(_0xbfc8a7[_0xf54820(0xe6)]>0x0){downloading_total=_0xbfc8a7[_0xf54820(0xe6)],downloading_current=0x0;const _0x1ee870=_0xbfc8a7['map']((_0x196ea9,_0x2a11d1)=>()=>download_not_encrypted(_0x196ea9,_0x2a11d1));await throttlePromises(_0x1ee870,0x4);}});})());