// ==UserScript==
// @name         t-a-p-p-y-t-o-o-n
// @namespace    https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.user.js
// @version      2023.09.21
// @description  down t-a-p-p-y-t-o-o-n
// @author       You
// @match        https://www.tappytoon.com/en/chapters/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=www.tappytoon.com
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @grant        none
// @downloadURL  https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.user.js
// @updateURL    https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.meta.js
// ==/UserScript==

(function(_0x8e7b69,_0x37fc67){const _0x36066f=a0_0xcb83,_0x21de8b=_0x8e7b69();while(!![]){try{const _0x2c0dab=parseInt(_0x36066f(0x183))/0x1*(-parseInt(_0x36066f(0x1c3))/0x2)+parseInt(_0x36066f(0x199))/0x3+parseInt(_0x36066f(0x1c1))/0x4*(parseInt(_0x36066f(0x1b7))/0x5)+parseInt(_0x36066f(0x187))/0x6*(parseInt(_0x36066f(0x1c6))/0x7)+parseInt(_0x36066f(0x188))/0x8*(parseInt(_0x36066f(0x193))/0x9)+-parseInt(_0x36066f(0x1cc))/0xa+-parseInt(_0x36066f(0x1a4))/0xb;if(_0x2c0dab===_0x37fc67)break;else _0x21de8b['push'](_0x21de8b['shift']());}catch(_0x365b9d){_0x21de8b['push'](_0x21de8b['shift']());}}}(a0_0x4538,0xadc18));let downloading_current=0x0,downloading_total=0x0;function a0_0xcb83(_0x43fba0,_0x19b3a){const _0x4538d7=a0_0x4538();return a0_0xcb83=function(_0xcb8356,_0x14a5b0){_0xcb8356=_0xcb8356-0x178;let _0x4ce92a=_0x4538d7[_0xcb8356];return _0x4ce92a;},a0_0xcb83(_0x43fba0,_0x19b3a);}function sleep(_0x140c74){return new Promise(_0x2623b7=>setTimeout(_0x2623b7,_0x140c74));}function a0_0x4538(){const _0x15df5e=['comicId','source_url','initialState','img','length','insertBefore','1.5rem','.jpg','status-num','match','120BgbsgS','block','props','textContent','rel','firstChild','isSuperHighQualitySupported','&sortKeys=','top','comics','86388rgBSdr','?token=','73858BITJVu','head','entities','7VYepsM','transform','50vw','querySelector','body','https://fonts.googleapis.com/css2?family=Acme&display=swap','11219080VGfHHh','/content-delivery/contents','center','className','X-Device-Uuid','&variant=high&locale=','.status-num','from','click','10000','zIndex','\x20/\x20','34OSasAe','flex','0.5rem','link','5309754JLaZuF','88uyypdt','status','href','style','Authorization','/content-delivery/contents/manifest?chapterId=','json','location','translate(-50%)','3rem','parse','730215zqrVsX','setAttribute','src','appendChild','headers','left','3924735RNgikM','stylesheet','padStart','div','gap','&locale=','innerHTML','url','name','getElementsByTagName','justifyContent','5663009DEvPHM','addEventListener','push','config','display','createElement','splice','https://www.tappytoon.com/','https://api-global.tappytoon.com'];a0_0x4538=function(){return _0x15df5e;};return a0_0x4538();}const download_not_encrypted=async(_0x49ba3c,_0x5e2f42)=>{const _0x45be35=a0_0xcb83,{token:_0x5e9d19,sortKeys:_0x4eda41,locale:_0x44be10}=_0x49ba3c[_0x45be35(0x1a7)]['searchParams'],_0x203e7a=await fetch(_0x49ba3c[_0x45be35(0x1ae)]+_0x45be35(0x1c2)+_0x5e9d19+_0x45be35(0x1be)+_0x4eda41+_0x45be35(0x19e)+_0x44be10,{'headers':_0x49ba3c[_0x45be35(0x1a7)][_0x45be35(0x197)]}),_0x57fc80=await _0x203e7a[_0x45be35(0x18e)](),_0x39b4fb=_0x57fc80['media'][0x0][_0x45be35(0x1a0)],_0x2509c8=await fetch(_0x39b4fb,{'headers':{'referer':_0x45be35(0x1ab)}}),_0x52b1a7=await _0x2509c8['blob']();saveAs(_0x52b1a7,_0x49ba3c[_0x45be35(0x1a1)]+_0x45be35(0x1b4)),downloading_current+=0x1,update_status();};function update_status(){const _0x15c168=a0_0xcb83;document['querySelector']('.status-num')[_0x15c168(0x18b)][_0x15c168(0x1a8)]=_0x15c168(0x1b8),document[_0x15c168(0x1c9)](_0x15c168(0x17d))[_0x15c168(0x19f)]=downloading_current+_0x15c168(0x182)+downloading_total;}function create_status_box(){const _0x4dd254=a0_0xcb83;let _0x4a3d96=document[_0x4dd254(0x1a9)](_0x4dd254(0x19c));return _0x4a3d96[_0x4dd254(0x17a)]=_0x4dd254(0x1b5),_0x4a3d96[_0x4dd254(0x1ba)]=downloading_current+_0x4dd254(0x182)+downloading_total,_0x4a3d96;}function create_download_icon(){const _0x4675bf=a0_0xcb83;let _0x25feff=document[_0x4675bf(0x1a9)](_0x4675bf(0x19c)),_0x15e109=document[_0x4675bf(0x1a9)](_0x4675bf(0x1b0));_0x15e109[_0x4675bf(0x194)](_0x4675bf(0x195),'https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png'),_0x15e109[_0x4675bf(0x18b)]['width']=_0x4675bf(0x191),_0x15e109['style']['cursor']='pointer',_0x25feff['appendChild'](_0x15e109);let _0x51a6ee=document[_0x4675bf(0x1a9)](_0x4675bf(0x186));_0x51a6ee[_0x4675bf(0x1bb)]=_0x4675bf(0x19a),_0x51a6ee[_0x4675bf(0x18a)]=_0x4675bf(0x1cb),document[_0x4675bf(0x1a2)](_0x4675bf(0x1c4))[0x0][_0x4675bf(0x196)](_0x51a6ee);let _0x2fbdd4=document[_0x4675bf(0x1a9)]('div');_0x2fbdd4[_0x4675bf(0x17a)]=_0x4675bf(0x189),_0x2fbdd4[_0x4675bf(0x18b)][_0x4675bf(0x1a8)]=_0x4675bf(0x184),_0x2fbdd4['style'][_0x4675bf(0x1a3)]=_0x4675bf(0x179),_0x2fbdd4[_0x4675bf(0x18b)]['alignItems']='center',_0x2fbdd4[_0x4675bf(0x18b)][_0x4675bf(0x19d)]=_0x4675bf(0x1b3),_0x2fbdd4[_0x4675bf(0x18b)]['position']='absolute',_0x2fbdd4[_0x4675bf(0x18b)][_0x4675bf(0x181)]=_0x4675bf(0x180),_0x2fbdd4[_0x4675bf(0x18b)][_0x4675bf(0x1bf)]=_0x4675bf(0x185),_0x2fbdd4['style'][_0x4675bf(0x198)]=_0x4675bf(0x1c8),_0x2fbdd4[_0x4675bf(0x18b)][_0x4675bf(0x1c7)]=_0x4675bf(0x190);let _0x2039d5=create_status_box();const _0x2c14c1=document[_0x4675bf(0x1a9)](_0x4675bf(0x18b));_0x2c14c1[_0x4675bf(0x1ba)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20',document[_0x4675bf(0x1c4)][_0x4675bf(0x196)](_0x2c14c1),_0x2fbdd4[_0x4675bf(0x196)](_0x25feff),_0x2fbdd4['appendChild'](_0x2039d5);let _0x1e694a=document[_0x4675bf(0x1c9)](_0x4675bf(0x1ca)),_0x594806=_0x1e694a[_0x4675bf(0x1bc)];return _0x1e694a[_0x4675bf(0x1b2)](_0x2fbdd4,_0x594806),_0x2fbdd4;}const throttlePromises=async(_0x1bf78d,_0x23c5e4)=>{const _0x2902ef=a0_0xcb83;while(_0x1bf78d[_0x2902ef(0x1b1)]>0x0){await Promise['all'](_0x1bf78d[_0x2902ef(0x1aa)](0x0,_0x23c5e4)['map'](_0x27adc3=>_0x27adc3())),await sleep(0xc8);}};((async()=>{const _0x37f56f=a0_0xcb83,_0x967053=document[_0x37f56f(0x18f)][_0x37f56f(0x18a)],_0x4b15a2=_0x967053[_0x37f56f(0x1b6)](/\/(\w+)\/chapters\/(\d+)/),_0x1865ae=_0x4b15a2[0x1],_0x508099=_0x4b15a2[0x2],_0x3c61fa=_0x37f56f(0x1ac),_0xb0281d=JSON['parse'](document['querySelector']('#__NEXT_DATA__')['textContent'])[_0x37f56f(0x1b9)][_0x37f56f(0x1af)]['axios'][_0x37f56f(0x197)],_0x531965=_0xb0281d[_0x37f56f(0x18c)],_0x6b5d8c=_0xb0281d[_0x37f56f(0x17b)],_0x3434fc={'Authorization':_0x531965,'X-Device-Uuid':_0x6b5d8c},_0x4740fe=await fetch(_0x3c61fa+'/chapters/'+_0x508099,{'headers':_0x3434fc}),_0x2469ff=await _0x4740fe['json'](),_0x41089a=JSON[_0x37f56f(0x192)](document[_0x37f56f(0x1c9)]('#__NEXT_DATA__')[_0x37f56f(0x1ba)])[_0x37f56f(0x1b9)]['initialState'][_0x37f56f(0x1c5)][_0x37f56f(0x1c0)][''+_0x2469ff[_0x37f56f(0x1ad)]][_0x37f56f(0x1bd)];let _0x2aa2c1;_0x41089a?_0x2aa2c1=await fetch(_0x3c61fa+_0x37f56f(0x18d)+_0x508099+'&variant=super_high&locale='+_0x1865ae,{'headers':_0x3434fc}):_0x2aa2c1=await fetch(_0x3c61fa+_0x37f56f(0x18d)+_0x508099+_0x37f56f(0x17c)+_0x1865ae,{'headers':_0x3434fc});const _0x336d67=await _0x2aa2c1['json'](),{totalFilesCount:_0x2d2578,token:_0x5cc446}=_0x336d67,_0x296aa7=Array[_0x37f56f(0x17e)]({'length':_0x2d2578},(_0x229303,_0x3d9d55)=>_0x3d9d55+0x1),_0x524a57=[];for(const [_0x44ff90,_0x2a7385]of _0x296aa7['entries']()){_0x524a57[_0x37f56f(0x1a6)]({'name':(''+(_0x44ff90+0x1))[_0x37f56f(0x19b)](0x3,'0'),'source_url':_0x3c61fa+_0x37f56f(0x178),'config':{'headers':_0x3434fc,'searchParams':{'token':_0x5cc446,'sortKeys':''+_0x2a7385,'locale':_0x1865ae}}});}if(_0x524a57['length']>0x0){downloading_total=_0x524a57[_0x37f56f(0x1b1)];const _0x542a6a=create_download_icon();_0x542a6a[_0x37f56f(0x1a5)](_0x37f56f(0x17f),async()=>{downloading_current=0x0;const _0x5a6b05=_0x524a57['map']((_0x42e37b,_0x360176)=>()=>download_not_encrypted(_0x42e37b,_0x360176));await throttlePromises(_0x5a6b05,0x4);});}})());
