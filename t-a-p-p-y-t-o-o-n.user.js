// ==UserScript==
// @name         t-a-p-p-y-t-o-o-n
// @namespace    https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.user.js
// @version      2023.09.22
// @description  down t-a-p-p-y-t-o-o-n
// @author       You
// @match        https://www.tappytoon.com/en/chapters/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=www.tappytoon.com
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @grant        none
// @downloadURL  https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.user.js
// @updateURL    https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.meta.js
// ==/UserScript==

(function(_0x34672c,_0x525021){const _0x3a757a=a0_0x1fe0,_0xe5b8b3=_0x34672c();while(!![]){try{const _0x295204=-parseInt(_0x3a757a(0x146))/0x1*(parseInt(_0x3a757a(0x17f))/0x2)+-parseInt(_0x3a757a(0x182))/0x3+parseInt(_0x3a757a(0x18d))/0x4+-parseInt(_0x3a757a(0x13d))/0x5+parseInt(_0x3a757a(0x179))/0x6+-parseInt(_0x3a757a(0x172))/0x7*(-parseInt(_0x3a757a(0x184))/0x8)+parseInt(_0x3a757a(0x180))/0x9*(-parseInt(_0x3a757a(0x141))/0xa);if(_0x295204===_0x525021)break;else _0xe5b8b3['push'](_0xe5b8b3['shift']());}catch(_0x41ce34){_0xe5b8b3['push'](_0xe5b8b3['shift']());}}}(a0_0x5e81,0x4bd81));function a0_0x1fe0(_0x246813,_0x37d177){const _0x5e81b8=a0_0x5e81();return a0_0x1fe0=function(_0x1fe090,_0x27e07b){_0x1fe090=_0x1fe090-0x135;let _0x3801dc=_0x5e81b8[_0x1fe090];return _0x3801dc;},a0_0x1fe0(_0x246813,_0x37d177);}let downloading_current=0x0,downloading_total=0x0;function sleep(_0x27bc8a){return new Promise(_0x2e8f26=>setTimeout(_0x2e8f26,_0x27bc8a));}const download_not_encrypted=async(_0x428bbb,_0x3e672b)=>{const _0x3c1010=a0_0x1fe0,{token:_0x30bc74,sortKeys:_0x42ebb9,locale:_0x4f9f43}=_0x428bbb[_0x3c1010(0x18e)][_0x3c1010(0x161)],_0x5746ad=await fetch(_0x428bbb[_0x3c1010(0x176)]+_0x3c1010(0x173)+_0x30bc74+'&sortKeys='+_0x42ebb9+_0x3c1010(0x16e)+_0x4f9f43,{'headers':_0x428bbb['config'][_0x3c1010(0x167)]}),_0x1d8bb6=await _0x5746ad[_0x3c1010(0x15a)](),_0x12094b=_0x1d8bb6[_0x3c1010(0x135)][0x0][_0x3c1010(0x18c)],_0x11ead1=await fetch(_0x12094b,{'headers':{'referer':'https://www.tappytoon.com/'}}),_0x193d8c=await _0x11ead1['blob']();saveAs(_0x193d8c,_0x428bbb['name']+'.jpg'),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();};function update_status(){const _0x128b43=a0_0x1fe0;document[_0x128b43(0x151)](_0x128b43(0x169))[_0x128b43(0x140)]['display']=_0x128b43(0x15c),document['querySelector']('.status-num')[_0x128b43(0x16f)]=downloading_current+_0x128b43(0x153)+downloading_total;}function a0_0x5e81(){const _0x3b0a87=['1.5rem','click','comics','comicId','splice','\x0a\x20\x20\x20\x20\x20\x20.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform-origin:\x20center;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20@keyframes\x20heartbeat\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2025%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2075%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20','pointer','10000','stylesheet','none','querySelector','Authorization','\x20/\x20','50vw','status','zIndex','&variant=high&locale=','padStart','className','json','status-num','block','parse','center','flex','top','searchParams','div','left','all','props','/content-delivery/contents/manifest?chapterId=','headers','firstChild','.status-num','&variant=super_high&locale=','absolute','initialState','href','&locale=','innerHTML','getElementsByTagName','map','343329ZrafLx','?token=','transform','createElement','source_url','link','entries','2751006iscDGL','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','img','setAttribute','gap','0.5rem','5638irgiIb','99ijXLei','addEventListener','357942tjbqbC','tai-ve','80qtUDqc','from','width','rel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','alignItems','match','src','url','312116jWjpks','config','body','media','length','head','https://fonts.googleapis.com/css2?family=Acme&display=swap','X-Device-Uuid','/content-delivery/contents','animation','axios','570215vpnYAS','translate(-50%)','appendChild','style','431390xiTfgU','isSuperHighQualitySupported','.tai-ve','textContent','#__NEXT_DATA__','3GQmDIL'];a0_0x5e81=function(){return _0x3b0a87;};return a0_0x5e81();}function create_status_box(){const _0x452752=a0_0x1fe0;let _0xece54e=document['createElement'](_0x452752(0x162));return _0xece54e['className']=_0x452752(0x15b),_0xece54e[_0x452752(0x144)]=downloading_current+'\x20/\x20'+downloading_total,_0xece54e;}function create_download_icon(){const _0x3c1a7c=a0_0x1fe0;let _0x20a357=document['createElement'](_0x3c1a7c(0x162)),_0x3515ca=document[_0x3c1a7c(0x175)](_0x3c1a7c(0x17b));_0x3515ca['className']=_0x3c1a7c(0x183),_0x3515ca[_0x3c1a7c(0x17c)](_0x3c1a7c(0x18b),_0x3c1a7c(0x17a)),_0x3515ca['style'][_0x3c1a7c(0x186)]='3rem',_0x3515ca['style']['cursor']=_0x3c1a7c(0x14d),_0x20a357[_0x3c1a7c(0x13f)](_0x3515ca);let _0x105fc7=document[_0x3c1a7c(0x175)](_0x3c1a7c(0x177));_0x105fc7[_0x3c1a7c(0x187)]=_0x3c1a7c(0x14f),_0x105fc7[_0x3c1a7c(0x16d)]=_0x3c1a7c(0x138),document[_0x3c1a7c(0x170)](_0x3c1a7c(0x137))[0x0][_0x3c1a7c(0x13f)](_0x105fc7);let _0x208ff7=document[_0x3c1a7c(0x175)](_0x3c1a7c(0x162));_0x208ff7[_0x3c1a7c(0x159)]=_0x3c1a7c(0x155),_0x208ff7[_0x3c1a7c(0x140)]['display']=_0x3c1a7c(0x15f),_0x208ff7[_0x3c1a7c(0x140)]['justifyContent']=_0x3c1a7c(0x15e),_0x208ff7[_0x3c1a7c(0x140)][_0x3c1a7c(0x189)]='center',_0x208ff7[_0x3c1a7c(0x140)][_0x3c1a7c(0x17d)]=_0x3c1a7c(0x147),_0x208ff7[_0x3c1a7c(0x140)]['position']=_0x3c1a7c(0x16b),_0x208ff7[_0x3c1a7c(0x140)][_0x3c1a7c(0x156)]=_0x3c1a7c(0x14e),_0x208ff7[_0x3c1a7c(0x140)][_0x3c1a7c(0x160)]=_0x3c1a7c(0x17e),_0x208ff7[_0x3c1a7c(0x140)][_0x3c1a7c(0x163)]=_0x3c1a7c(0x154),_0x208ff7[_0x3c1a7c(0x140)][_0x3c1a7c(0x174)]=_0x3c1a7c(0x13e);let _0x1ca863=create_status_box();const _0x543cf8=document[_0x3c1a7c(0x175)](_0x3c1a7c(0x140));_0x543cf8[_0x3c1a7c(0x144)]=_0x3c1a7c(0x188),document[_0x3c1a7c(0x137)][_0x3c1a7c(0x13f)](_0x543cf8),_0x208ff7[_0x3c1a7c(0x13f)](_0x20a357),_0x208ff7[_0x3c1a7c(0x13f)](_0x1ca863);let _0x599b13=document[_0x3c1a7c(0x151)](_0x3c1a7c(0x18f)),_0x58b938=_0x599b13[_0x3c1a7c(0x168)];return _0x599b13['insertBefore'](_0x208ff7,_0x58b938),_0x208ff7;}const throttlePromises=async(_0x53c16a,_0x206cf9)=>{const _0x102ea1=a0_0x1fe0;while(_0x53c16a['length']>0x0){await Promise[_0x102ea1(0x164)](_0x53c16a[_0x102ea1(0x14b)](0x0,_0x206cf9)[_0x102ea1(0x171)](_0x5f5ae5=>_0x5f5ae5())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x2814e2=a0_0x1fe0,_0x2e7a7c=document[_0x2814e2(0x175)]('style');_0x2e7a7c['textContent']=_0x2814e2(0x14c),document[_0x2814e2(0x137)][_0x2814e2(0x13f)](_0x2e7a7c);},off_heartbeat_css=()=>{const _0x572ddb=a0_0x1fe0,_0x331556=document[_0x572ddb(0x151)](_0x572ddb(0x143));_0x331556[_0x572ddb(0x140)][_0x572ddb(0x13b)]=_0x572ddb(0x150);};((async()=>{const _0x371462=a0_0x1fe0,_0x3dd3c9=document['location'][_0x371462(0x16d)],_0x2e73dd=_0x3dd3c9[_0x371462(0x18a)](/\/(\w+)\/chapters\/(\d+)/),_0x4d0c84=_0x2e73dd[0x1],_0x12ddd0=_0x2e73dd[0x2],_0x1236bb='https://api-global.tappytoon.com',_0x1773b8=JSON[_0x371462(0x15d)](document['querySelector'](_0x371462(0x145))['textContent'])[_0x371462(0x165)][_0x371462(0x16c)][_0x371462(0x13c)][_0x371462(0x167)],_0x245852=_0x1773b8[_0x371462(0x152)],_0x1be4f5=_0x1773b8[_0x371462(0x139)],_0x2bfdfa={'Authorization':_0x245852,'X-Device-Uuid':_0x1be4f5},_0x3cebca=await fetch(_0x1236bb+'/chapters/'+_0x12ddd0,{'headers':_0x2bfdfa}),_0x14b52a=await _0x3cebca[_0x371462(0x15a)](),_0x47cd5a=JSON['parse'](document[_0x371462(0x151)]('#__NEXT_DATA__')[_0x371462(0x144)])[_0x371462(0x165)][_0x371462(0x16c)]['entities'][_0x371462(0x149)][''+_0x14b52a[_0x371462(0x14a)]][_0x371462(0x142)];let _0x1483b5;_0x47cd5a?_0x1483b5=await fetch(_0x1236bb+'/content-delivery/contents/manifest?chapterId='+_0x12ddd0+_0x371462(0x16a)+_0x4d0c84,{'headers':_0x2bfdfa}):_0x1483b5=await fetch(_0x1236bb+_0x371462(0x166)+_0x12ddd0+_0x371462(0x157)+_0x4d0c84,{'headers':_0x2bfdfa});const _0x5830c7=await _0x1483b5[_0x371462(0x15a)](),{totalFilesCount:_0x5c1e59,token:_0x40f084}=_0x5830c7,_0x4cd80d=Array[_0x371462(0x185)]({'length':_0x5c1e59},(_0x13c44a,_0x170467)=>_0x170467+0x1),_0x2ec9ee=[];for(const [_0x52f280,_0x45e0e0]of _0x4cd80d[_0x371462(0x178)]()){_0x2ec9ee['push']({'name':(''+(_0x52f280+0x1))[_0x371462(0x158)](0x3,'0'),'source_url':_0x1236bb+_0x371462(0x13a),'config':{'headers':_0x2bfdfa,'searchParams':{'token':_0x40f084,'sortKeys':''+_0x45e0e0,'locale':_0x4d0c84}}});}if(_0x2ec9ee['length']>0x0){downloading_total=_0x2ec9ee[_0x371462(0x136)];const _0x2ae3b8=create_download_icon();_0x2ae3b8[_0x371462(0x181)](_0x371462(0x148),async()=>{on_heartbeat_css(),downloading_current=0x0;const _0x201c1c=_0x2ec9ee['map']((_0x18a10e,_0x398d6a)=>()=>download_not_encrypted(_0x18a10e,_0x398d6a));await throttlePromises(_0x201c1c,0x4);});}})());