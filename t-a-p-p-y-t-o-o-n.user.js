// ==UserScript==
// @name         t-a-p-p-y-t-o-o-n
// @namespace    https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.user.js
// @version      2024.01.09
// @description  down t-a-p-p-y-t-o-o-n
// @author       You
// @match        https://www.tappytoon.com/en/chapters/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=www.tappytoon.com
// @require      https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js
// @grant        none
// @downloadURL  https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.user.js
// @updateURL    https://github.com/bideoncenten/ngoai_sau_muoi/raw/main/t-a-p-p-y-t-o-o-n.meta.js
// ==/UserScript==

(function(_0x3a9992,_0x571854){const _0x9f3479=a0_0xe97f,_0x875a7b=_0x3a9992();while(!![]){try{const _0x4513f2=-parseInt(_0x9f3479(0xe5))/0x1*(parseInt(_0x9f3479(0xd4))/0x2)+parseInt(_0x9f3479(0xf0))/0x3+parseInt(_0x9f3479(0xc1))/0x4+parseInt(_0x9f3479(0xea))/0x5*(parseInt(_0x9f3479(0xe2))/0x6)+-parseInt(_0x9f3479(0xaf))/0x7*(parseInt(_0x9f3479(0xcf))/0x8)+parseInt(_0x9f3479(0xf8))/0x9+-parseInt(_0x9f3479(0xc8))/0xa*(parseInt(_0x9f3479(0xd9))/0xb);if(_0x4513f2===_0x571854)break;else _0x875a7b['push'](_0x875a7b['shift']());}catch(_0x1e9f18){_0x875a7b['push'](_0x875a7b['shift']());}}}(a0_0x28bc,0xb5a5a));function a0_0xe97f(_0xbb938d,_0x5be531){const _0x28bc0d=a0_0x28bc();return a0_0xe97f=function(_0xe97f24,_0x5789c5){_0xe97f24=_0xe97f24-0x9f;let _0x5b3cae=_0x28bc0d[_0xe97f24];return _0x5b3cae;},a0_0xe97f(_0xbb938d,_0x5be531);}function a0_0x28bc(){const _0x4b331e=['searchParams','heartbeat','rel','&variant=super_high&locale=','#heartbeat','&locale=','\x20/\x20','Authorization','4596xewxkV','https://www.tappytoon.com/','translate(-50%)','1462939tQDpYX','src','status-num','div','3rem','5330ZjEoEu','entries','axios','&variant=high&locale=','addEventListener','className','3149127Cgtjjx','transform','0.5rem','tai-ve','props','textContent','justifyContent','padStart','11906289nzRXdL','length','click','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','?token=','left','appendChild','entities','\x0a\x20\x20\x20\x20\x20\x20.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform-origin:\x20center;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20@keyframes\x20heartbeat\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2025%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2075%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20','/content-delivery/contents/manifest?chapterId=','width','.status-num','head','innerHTML','alignItems','block','#__NEXT_DATA__','center','config','483KIpZEx','json','media','href','top','display','setAttribute','10000','/content-delivery/contents','source_url','firstChild','comicId','location','url','querySelector','parse','map','createElement','4744340wRXzqj','gap','stylesheet','style','X-Device-Uuid','img','.jpg','10oNrSOO','getElementsByTagName','initialState','headers','1.5rem','comics','sortKey','105120gyAHCT','/chapters/','https://fonts.googleapis.com/css2?family=Acme&display=swap','push','\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-num\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x203rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#FD7377;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20-webkit-text-stroke:\x201px\x20#C62428;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x200.2rem\x20solid\x20#167975;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x201rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x202rem;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20#F9FDFD;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20','2iRbRPD','splice','https://api-global.tappytoon.com','link','zIndex','13878106hxxLAr'];a0_0x28bc=function(){return _0x4b331e;};return a0_0x28bc();}let downloading_current=0x0,downloading_total=0x0;function sleep(_0x2fcd17){return new Promise(_0x44f430=>setTimeout(_0x44f430,_0x2fcd17));}const download_not_encrypted=async(_0x39be26,_0x1f1306,_0x2214f6=0x0)=>{const _0x210721=a0_0xe97f;try{const {token:_0x499d12,sortKeys:_0x550ed9,locale:_0x2b2306}=_0x39be26[_0x210721(0xae)][_0x210721(0xda)],_0x488337=await fetch(_0x39be26[_0x210721(0xb8)]+_0x210721(0xa0)+_0x499d12+'&sortKeys='+_0x550ed9+_0x210721(0xdf)+_0x2b2306,{'headers':_0x39be26[_0x210721(0xae)][_0x210721(0xcb)]}),_0x1e0797=await _0x488337['json'](),_0x24108a=_0x1e0797[_0x210721(0xb1)][0x0][_0x210721(0xbc)],_0x58ded3=await fetch(_0x24108a,{'headers':{'referer':_0x210721(0xe3)}}),_0x287329=await _0x58ded3['blob']();saveAs(_0x287329,_0x39be26['name']+_0x210721(0xc7)),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();}catch(_0x3a536d){_0x2214f6<0x3&&(_0x2214f6+=0x1,download_not_encrypted(_0x39be26,_0x1f1306,_0x2214f6));}};function update_status(){const _0xf9d3d9=a0_0xe97f;document[_0xf9d3d9(0xbd)](_0xf9d3d9(0xa7))[_0xf9d3d9(0xc4)][_0xf9d3d9(0xb4)]=_0xf9d3d9(0xab),document['querySelector'](_0xf9d3d9(0xa7))[_0xf9d3d9(0xa9)]=downloading_current+_0xf9d3d9(0xe0)+downloading_total;}function create_status_box(){const _0x2e38b0=a0_0xe97f;let _0x218996=document['createElement'](_0x2e38b0(0xe8));return _0x218996[_0x2e38b0(0xef)]=_0x2e38b0(0xe7),_0x218996['textContent']=downloading_current+_0x2e38b0(0xe0)+downloading_total,_0x218996;}function create_download_icon(){const _0x334757=a0_0xe97f;let _0x58ed0e=document[_0x334757(0xc0)](_0x334757(0xe8)),_0x4669c9=document[_0x334757(0xc0)](_0x334757(0xc6));_0x4669c9[_0x334757(0xef)]=_0x334757(0xf3),_0x4669c9[_0x334757(0xb5)](_0x334757(0xe6),_0x334757(0x9f)),_0x4669c9[_0x334757(0xc4)][_0x334757(0xa6)]=_0x334757(0xe9),_0x4669c9[_0x334757(0xc4)]['cursor']='pointer',_0x58ed0e[_0x334757(0xa2)](_0x4669c9);let _0x4633f6=document[_0x334757(0xc0)](_0x334757(0xd7));_0x4633f6[_0x334757(0xdc)]=_0x334757(0xc3),_0x4633f6[_0x334757(0xb2)]=_0x334757(0xd1),document[_0x334757(0xc9)](_0x334757(0xa8))[0x0][_0x334757(0xa2)](_0x4633f6);let _0x4ff315=document[_0x334757(0xc0)](_0x334757(0xe8));_0x4ff315[_0x334757(0xef)]='status',_0x4ff315[_0x334757(0xc4)][_0x334757(0xb4)]='flex',_0x4ff315[_0x334757(0xc4)][_0x334757(0xf6)]=_0x334757(0xad),_0x4ff315[_0x334757(0xc4)][_0x334757(0xaa)]=_0x334757(0xad),_0x4ff315[_0x334757(0xc4)][_0x334757(0xc2)]=_0x334757(0xcc),_0x4ff315[_0x334757(0xc4)]['position']='absolute',_0x4ff315['style'][_0x334757(0xd8)]=_0x334757(0xb6),_0x4ff315[_0x334757(0xc4)][_0x334757(0xb3)]=_0x334757(0xf2),_0x4ff315[_0x334757(0xc4)][_0x334757(0xa1)]='50vw',_0x4ff315[_0x334757(0xc4)][_0x334757(0xf1)]=_0x334757(0xe4);let _0x2bcf27=create_status_box();const _0x215caa=document[_0x334757(0xc0)](_0x334757(0xc4));_0x215caa[_0x334757(0xf5)]=_0x334757(0xd3),document['head'][_0x334757(0xa2)](_0x215caa),_0x4ff315['appendChild'](_0x58ed0e),_0x4ff315[_0x334757(0xa2)](_0x2bcf27);let _0x4fbaea=document[_0x334757(0xbd)]('body'),_0x25d3fd=_0x4fbaea[_0x334757(0xb9)];return _0x4fbaea['insertBefore'](_0x4ff315,_0x25d3fd),_0x4ff315;}const throttlePromises=async(_0x983927,_0xa4df47)=>{const _0x3c2b67=a0_0xe97f;while(_0x983927['length']>0x0){await Promise['all'](_0x983927[_0x3c2b67(0xd5)](0x0,_0xa4df47)[_0x3c2b67(0xbf)](_0x1c32f3=>_0x1c32f3())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x48aa16=a0_0xe97f;let _0x2e7cb8=document[_0x48aa16(0xbd)](_0x48aa16(0xde));!_0x2e7cb8&&(_0x2e7cb8=document[_0x48aa16(0xc0)](_0x48aa16(0xc4)),_0x2e7cb8[_0x48aa16(0xb5)]('id',_0x48aa16(0xdb)),document[_0x48aa16(0xa8)]['appendChild'](_0x2e7cb8)),_0x2e7cb8[_0x48aa16(0xf5)]=_0x48aa16(0xa4);},off_heartbeat_css=()=>{const _0x1de717=a0_0xe97f,_0x44dafd=document[_0x1de717(0xbd)](_0x1de717(0xde));_0x44dafd['textContent']='';};((async()=>{const _0xe1c04f=a0_0xe97f,_0x5e7f52=create_download_icon();_0x5e7f52[_0xe1c04f(0xee)](_0xe1c04f(0xfa),async()=>{const _0x25b0b2=_0xe1c04f;on_heartbeat_css();const _0x3ea720=document[_0x25b0b2(0xbb)][_0x25b0b2(0xb2)],_0x5f1462=_0x3ea720['match'](/\/(\w+)\/chapters\/(\d+)/),_0x261287=_0x5f1462[0x1],_0x5b2dfe=_0x5f1462[0x2],_0x431a50=_0x25b0b2(0xd6),_0x1e6db0=JSON[_0x25b0b2(0xbe)](document[_0x25b0b2(0xbd)](_0x25b0b2(0xac))[_0x25b0b2(0xf5)])['props'][_0x25b0b2(0xca)][_0x25b0b2(0xec)][_0x25b0b2(0xcb)],_0x5ca9c5=_0x1e6db0[_0x25b0b2(0xe1)],_0x4f8b29=_0x1e6db0[_0x25b0b2(0xc5)],_0x35b025={'Authorization':_0x5ca9c5,'X-Device-Uuid':_0x4f8b29},_0x6e8436=await fetch(_0x431a50+_0x25b0b2(0xd0)+_0x5b2dfe,{'headers':_0x35b025}),_0x4f6fce=await _0x6e8436['json'](),_0x14e116=JSON[_0x25b0b2(0xbe)](document['querySelector'](_0x25b0b2(0xac))[_0x25b0b2(0xf5)])[_0x25b0b2(0xf4)][_0x25b0b2(0xca)][_0x25b0b2(0xa3)][_0x25b0b2(0xcd)][''+_0x4f6fce[_0x25b0b2(0xba)]]['isSuperHighQualitySupported'];let _0x13b1ea;_0x14e116?_0x13b1ea=await fetch(_0x431a50+'/content-delivery/contents/manifest?chapterId='+_0x5b2dfe+_0x25b0b2(0xdd)+_0x261287,{'headers':_0x35b025}):_0x13b1ea=await fetch(_0x431a50+_0x25b0b2(0xa5)+_0x5b2dfe+_0x25b0b2(0xed)+_0x261287,{'headers':_0x35b025});const _0x2519ee=await _0x13b1ea[_0x25b0b2(0xb0)](),{totalFilesCount:_0x14005b,token:_0x14409b,files:_0x4bc4b6}=_0x2519ee,_0x250472=[];for(const [_0x10bc21,_0x16ad26]of _0x4bc4b6[_0x25b0b2(0xeb)]()){_0x250472[_0x25b0b2(0xd2)]({'name':(''+(_0x10bc21+0x1))[_0x25b0b2(0xf7)](0x3,'0'),'source_url':_0x431a50+_0x25b0b2(0xb7),'config':{'headers':_0x35b025,'searchParams':{'token':_0x14409b,'sortKeys':''+_0x16ad26[_0x25b0b2(0xce)],'locale':_0x261287}}});}if(_0x250472[_0x25b0b2(0xf9)]>0x0){downloading_total=_0x250472['length'],downloading_current=0x0;const _0x2e200b=_0x250472['map']((_0x2b4598,_0x468e5f)=>()=>download_not_encrypted(_0x2b4598,_0x468e5f));await throttlePromises(_0x2e200b,0x4);}});})());